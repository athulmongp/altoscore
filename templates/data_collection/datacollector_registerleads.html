{% extends 'data_collection/datacollect_index.html' %} 
{% load static %} 
{% block content %}

<style>
    #register-section
    {
        display: grid;
        grid-template-columns:1.5fr 1.4fr;
      
        gap: 1em;
        
    }
    .register-form
    {
        background-color: #191c24;
        padding: 1.6em;

    }
    #reg-form
    {
        padding: 1em;
    }
    #reg-form .input-group
    {
        margin-top: 1em;
    }
    #reg-form .input-group label
    {
        width: 40%;
        font-size: 0.90em;
    }
    #reg-form .input-group input, textarea
    {
        width: 60%;
        background-color: #2c2c2e;
        border: none;
        height: 45px;
        color: rgb(233, 233, 233);
        padding: 0.70em;
        font-size: 0.89em;
    }
    .input-group_btn
    {
        text-align: center;
        margin-top: 1em;
    }

    #msg .msgs
        {
          color: rgb(234, 37, 37);
          letter-spacing: 0.03rem;
        }
        .input_group
{
    margin-top: 2.2em;
    width:100%;
}
.input_group label
{
    font-size: 0.85em;
    width: 30%;
}
.input_group input
{
    padding: 0.30em;
    font-size: 0.85em;
    width: 60%;
   
}
.input_group_save
{
    margin-top: 2.4em;
    text-align: center;
}
    </style>


<div class="container" id="register-section">
    <div class="register-form">
        <h4 class="text-center">Register Leads</h4>
        <form action="{% url 'data_collector_register_save' %}"  method='post' class="form mt-3" id="reg-form">
            {% csrf_token %}
            <div class="input-group">
                <label>Name :</label>
                <input type="text" name="dc_name">
            </div>
            
            <div class="input-group">
                <label>Email :</label>
                <input type="email" name="dc_email" id="email">
                <p id="msg"><span id="email-message" class="msgs"></span> </p>
            </div>
            <div class="input-group">
                <label>Contact :</label>
                <input type="tel" name="dc_phno" id="phno">
                <p id="msg"><span id="phno-message" class="msgs"></span></p>
            </div>
            <div class="input-group">
                <label >Place :</label>
                <input type="text" name="dc_place">
            </div>
            <div class="input-group">
                <label>Other Details :</label>
                <textarea name="dc_other"></textarea>
            </div>
            <div class="input-group_btn">
                <button type="save" class="btn btn-outline-success">Save</button>
            </div>
        </form>
    </div>
    <!-- Serach Section -->
<div class="container ">
    
    <div class="row ">
        <div class="col-12 grid-margin">
            <div class="card">
                <div class="card-body">
                    <h4 class="card-title">Registered Leads Search </h4>
                    <form action="{% url 'datacollector_Registered_search' %}" method="post">
                        {% csrf_token %}
                        <div class="input_group">
                            <label>Registered Start date :</label>
                            <input type="date" name="register_stdate">
                        </div>
                        <div class="input_group">
                            <label>Registered End date :</label>
                            <input type="date" name="register_enddate">
                        </div>
                        <div class="input_group_save">
                            <button type="submit" class="btn btn-outline-primary">Search</button>
                        </div>
                       
                    </form>
                    
                </div>
            </div>
        </div>
    </div>
    
    </div>
    
</div>



<style>
    #register-details_filter
    {
       width: auto;
       margin-top:1em ;
       margin-bottom: 1.5em;
       width: 50%;
    }
   
    #register-details_wrapper button
    {
        font-size: 0.90em;
        border: none;
        padding: 0.30em 1em;
        border-radius: 10px;
    
    }
    .paginate_button
    {
        padding-right: 0.80em;
        color: azure;
        font-size: 0.89em;
        text-decoration: none;
      
    }
    
    #register-details_filter input[type="search"] {
       
        width:100%;
        height: 35px;
        
    }
    </style>

<div class="row mt-4">
    <div class="col-12 grid-margin">
        <div class="card">
            <div class="card-body">
                <h4 class="card-title">Registered Leads </h4>
                
                <div class="table-responsive">
                    <table class="table" id="register-details">
                        <thead>
                            <tr class="header" data-href="#">
                                <th>Full Name </th>
                                <th>Date </th>
                               
                                <th>Email id</th>
                                <th> Phone No </th>
                                <th> Place </th>
                                <th> Other Details</th>
                                <th>Status</th>

                            </tr>
                        </thead>
                        <tbody>
                            {% for i in ld %}
                            <tr>
                            
                                <td><span class="ps-2">{{ i.r_fullname }}</span></h5></td>
                                <td> {{ i.r_date }} </td>
                                <td> {{ i.r_email }} </td>
                                <td> {{ i.r_phno }} </td>
                                <td> {{ i.r_place }} </td>
                              
                                <td> {{ i.r_dese }} </td>
                              
                                <td>
                                    {% if i.r_type_status == '' %}
                                    Not Attempted
                                    {% elif i.r_type_status == '1' %}
                                    Interested
                                    {% endif %}
                                </td>
                               
                                
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $('#email').on('change', function() {
      var email = $(this).val();
      console.log(email)
      $.ajax({
          url: "{% url 'check_email' %}",
          data: {
              'email': email
          },
          dataType: 'json',
          success: function (data) {
              if (data.is_taken) {
                  $('#email-message').text('Email already exists !');
                  $('#email-message').addClass('msgs')
              } else {
                  $('#email-message').text('');
              }
          }
      });
  });
</script>

<script>
  $('#phno').on('change', function() {
    var phno = $(this).val();
    console.log(phno)
    $.ajax({
        url: "{% url 'check_phone' %}",
        data: {
            'phno': phno
        },
        dataType: 'json',
        success: function (data) {
            if (data.is_taken) {
                $('#phno-message').text('Phone Number already exists !');
                $('#phno-message').addClass('msgs')
            } else {
                $('#phno-message').text('');
            }
        }
    });
});
</script>


{% endblock %}